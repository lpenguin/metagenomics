<div class="heatmap-chart">
  <div class="heatmap-chart__header">
    <div
      class="resistance-group inline"
      data-ng-repeat="(resistance, substances) in data.resistances track by $index">
      <div class="resistance-caption">
        <span once-text="resistance.indexOf('(') !== -1 ? resistance.split('(')[0] : resistance"></span>
        <span
          class="tail"
          once-text="resistance.indexOf('(') !== -1 ? '(' + resistance.split('(')[1] : ''"></span>
      </div>
      <div
        class="substance-caption inline"
        data-ng-repeat="substance in ['overall'].concat(substances.length < 2 ? [] : substances) track by $index"
        once-class="{'overall': substance === 'overall'}"
        once-text="substance === 'overall' ? 'median' : substance.charAt(0)"></div>
      <br class="clear-both" />
    </div>
    <br class="clear-both" />
  </div>
  <div class="heatmap-chart__rows">
    <div
      class="row"
      data-ng-repeat="cohort in cohorts track by $index"
      data-ng-class="{'pushed': cohort.isPushed}">
      <img
        class="flag inline"
        data-ng-if="cohort.flag"
        data-ng-src="img/flags/{{cohort.flag}}.png" />
      <div
        class='name inline'
        data-ng-class="{'country': cohort.flag}">{{cohort.name}}</div>
      <div class='n-of-samples inline'>{{cohort.samples.length}}</div>
      <div
        class="resistance-group inline"
        data-ng-repeat="(resistance, substances) in data.resistances track by $index">
        <div
          class="substance-cell inline"
          data-ng-repeat="substance in ['overall'].concat(substances.length < 2 ? [] : substances) track by $index"
          data-ng-style="{'background-color': getCellColor(cohort, resistance, substance)}"
          data-ng-mouseover="substanceCellMouseover(cohort, resistance, substance)"
          data-ng-mouseout="substanceCellMouseout()"
          once-class="{'overall': substance === 'overall'}"></div>
        <br class="clear-both" />
      </div>
      <br class="clear-both" />
    </div>
  </div>
</div>
