<div class="heatmap-chart">
  <div class="heatmap-chart__rows">
    <div
      class="country-row"
      data-ng-repeat="country in (sortedCountries = (data.countries | orderBy:['-continent', 'name'])) track by $index"
      data-ng-class="{'pushed': $index && sortedCountries[$index]['continent'] !== sortedCountries[$index - 1]['continent'], 'unavailable': !SMP[country['name']] || (hoveredCountryId ? country['code'] !== hoveredCountryId : false)}">
      <img
        class="flag inline"
        data-ng-src="img/flags/{{country['name']}}.png" />
      <div class='name inline'>{{country['name']}}</div>
      <div class='n-of-samples inline'>{{SMP[country['name']] ? SMP[country['name']] : ''}}</div>
      <div
        class="substance-cell inline"
        data-ng-repeat="substance in data.resistances['antibiotic resistance'] track by $index"
        data-ng-style="{'background-color': getCellColor(country['name'], 'antibiotic resistance', substance)}"
        data-ng-mouseover="substanceCellMouseover(country['name'], 'antibiotic resistance', substance)"
        data-ng-mouseout="substanceCellMouseout()"
        data-ng-mousemove="substanceCellMousemove($event)"></div>
      <br class="clear-both" />
    </div>
  </div>
  <div class="heatmap-chart__legend">
    <div
      class="legend-caption left"
      data-ng-bind-html="abundanceValuesExtent[0] | prepareAbundanceValue:maxPower | trust"></div>
    <div
      class="legend-caption right"
      data-ng-bind-html="abundanceValuesExtent[1] | prepareAbundanceValue:maxPower | trust"></div>
    <div
      class="legend-gradient"
      data-ng-style="{'background': 'linear-gradient(to right, ' + gradient[0] + ', ' + gradient[1] + ')'}"></div>
    <div
      class="legend-pointer"
      data-ng-style="{'left': getLegendPointerX() + 'px'}"></div>
  </div>
  <div
    class="heatmap-chart__tooltip"
    data-ng-class="{'hidden': !tooltip.substance}"
    data-ng-style="{'transform': 'translate(' + tooltip.coordinates.x + 'px, ' + tooltip.coordinates.y + 'px)'}">
    <div
      class="tooltip-abundance-value"
      data-ng-bind-html="'Median abundance: ' + (tooltip.abundanceValue | prepareAbundanceValue:maxPower) | trust"></div>
    <div class="tooltip-n-of-samples">{{tooltip.nOfSamples + ' ' + (tooltip.nOfSamples === 1 ? 'sample' : 'samples')}}</div>
  </div>
</div>
